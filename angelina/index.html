<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>prototipo 4 cordinador</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <a href="../index.html"><img src="../img/Imagen_de_WhatsApp_2025-07-23_a_las_16.45.49_39b10a48-removebg-preview.png" alt="" class="escudo"></a>
    <a href="../index.html"><img src="../img/images-removebg-preview.png" alt="" class="bandera"></a>
    <div class="contenedor">
        <div class="login">
            <div class="contenedorLogin">
                <select id="docente">
                    <option value="." selected disabled>Selecciona el nombre del docente</option>
                    <option value="Adriana M. Sotelo Sánchez">Adriana M. Sotelo Sánchez</option>
                    <option value="Andres E. Campo">Andres E. Campo</option>
                    <option value="Beatriz E. Garcés Rodríguez">Beatriz E. Garcés Rodríguez</option>
                    <option value="Cecilia Hernández López">Cecilia Hernández López</option>
                    <option value="Damaso D. Cauca Oliveros">Damaso D. Cauca Oliveros</option>
                    <option value="Didienso F. Pareja Rios">Didienso F. Pareja Rios</option>
                    <option value="Diego A. Molina Sosa">Diego A. Molina Sosa</option>
                    <option value="Francened López Cardona">Francened López Cardona</option>
                    <option value="Jenny Quito">Jenny Quito</option>
                    <option value="Jhon J. Ibarra">Jhon J. Ibarra</option>
                    <option value="José D. Porto Mass">Jóse D. Porto Mass</option>
                    <option value="Juan S. Arango Giraldo">Juan S. Arango Giraldo</option>
                    <option value="Liliana M. Muños Mejía">Liliana M. Muños Mejía</option>
                    <option value="Luis F. Sánchez">Luis F. Sánchez</option>
                    <option value="Crisitian Muños">Crisitian Muños</option>
                    <option value="Luz E. Toro Cosme">Luz E. Toro Cosme</option>
                    <option value="Luz M. Arrieta Pérez">Luz M. Arrieta Pérez</option>
                    <option value="Maryueth Rincón Ochoa">Maryueth Rincón Ochoa</option>
                    <option value="Mauricio Foronda Martínez">Mauricio Foronda Martínez</option>
                    <option value="Miguel A. Nova Castellanos">Miguel A. Nova Castellanos</option>
                    <option value="Osvaldo Pedrozo Ospina">Osvaldo Pedrozo Ospina</option>
                    <option value="Erica Mira">Erica Mira</option>
                    <option value="Santiago Velasquez Quintero">Santiago Velasquez Quintero</option>
                    <option value="Saul A. Mejia Cuartas">Saul A. Mejia Cuartas</option>
                    <option value="Stella Vesga Rueda">Stella Vesga Rueda</option>
                    <option value="Tania E. López Muños">Tania E. López Muños</option>
                    <option value="Carlos Osorno">Carlos Osorno</option>
                    <option value="Todos">Todos</option>
                </select>
                <select id="horasNoDadas">
                    <option value=".">Horas de clase no efectivas</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select>
                <select id="motivo" class="oculto">
                    <option value="." selected disabled>Seleccione un motivo</option>
                    <option value="Permiso del docente">Permiso del docente</option>
                    <option value="Actividad Institucional">Actividad Institucional</option>
                    <option value="Actividad Externa">Actividad Externa</option>
                    <option value="Incapacidad">Incapacidad</option>
                </select>
                <input type="date" id="fecha">
                <button id="enviar">Enviar</button>
                <button id="descargar">Descargar excel</button>
            </div>
        </div>
    </div>
    <h2 class="cole">Angelina Arteaga</h2>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="script.js"></script>
    <script>
        document.getElementById('descargar').addEventListener('click', exportarExcel)
        async function exportarExcel() {
            const {data, error} = await client
                .from('prueba')
                .select('*');
        const resumen = {};

        data.forEach(({ nombre, motivo, horas }) => {
            if (!resumen[nombre]) resumen[nombre] = {};
            if (!resumen[nombre][motivo]) resumen[nombre][motivo] = 0;
            resumen[nombre][motivo] += parseInt(horas);
        });
        const todosLosMotivos = [...new Set(data.map(r => r.motivo))].filter(m => m !== 'N/A');

        const datosFinales = [];

        for (const docente in resumen) {
            const fila = { Docente: docente };
            todosLosMotivos.forEach(motivo => {
            fila[motivo] = resumen[docente][motivo] || 0;
        });
        datosFinales.push(fila);
        }

        const total = { Docente: "Total" };
        todosLosMotivos.forEach(motivo => {
            total[motivo] = datosFinales.reduce((suma, fila) => suma + (fila[motivo] || 0), 0);
        });
        datosFinales.push(total);

        const encabezados = ["Docente", ...todosLosMotivos];
        const ws = XLSX.utils.json_to_sheet([], { header: encabezados });

        datosFinales.forEach(fila => {
        const nuevaFila = [fila.Docente];
        todosLosMotivos.forEach(motivo => {
            nuevaFila.push(fila[motivo] ?? 0);
        });
        XLSX.utils.sheet_add_aoa(ws, [nuevaFila], { origin: -1 });
        });

        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Resumen");
        XLSX.writeFile(wb, "resumen_docentes.xlsx");
    }

</script>
</body>

</html>
